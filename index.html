<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Solicita√ß√£o de Servi√ßo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .preview-img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 10px;
    }
    .logo-icon {
      width: 80px;
      height: 80px;
      color: #2563eb;
    }
    footer {
      text-align: center;
      font-size: 0.875rem;
      color: #6b7280;
      margin-top: 1.5rem;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
  <div class="container max-w-2xl">
    <div class="bg-white rounded-2xl shadow-lg p-6 space-y-6">
      <div class="flex items-center gap-4">
        <!-- √çcone de Inova√ß√£o -->
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="logo-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 21h6v-1H9v1zm3-19C7.486 2 4 5.486 4 10c0 2.953 1.61 5.502 4 6.938V19a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.062c2.39-1.436 4-3.985 4-6.938 0-4.514-3.486-8-8-8zm2.938 13.406A1 1 0 0 0 14 16v2h-4v-2a1 1 0 0 0-.938-.594C8.09 15.174 6 12.879 6 10c0-3.309 2.691-6 6-6s6 2.691 6 6c0 2.879-2.09 5.174-4.062 6.406z"/>
        </svg>

        <div>
          <h1 class="text-2xl font-bold text-gray-800">Solicita√ß√£o de Servi√ßo</h1>
          <p class="text-gray-600 text-sm">Envie sua solicita√ß√£o com evid√™ncias diretamente pelo WhatsApp</p>
        </div>
      </div>

      <form id="serviceForm" class="space-y-4" novalidate>
        <div>
          <label for="name" class="block font-medium text-gray-700 mb-1">Nome Completo</label>
          <input id="name" name="name" type="text" required aria-required="true" class="w-full border rounded-lg p-2" placeholder="Digite seu nome completo">
        </div>

        <div>
          <label for="phone" class="block font-medium text-gray-700 mb-1">Telefone</label>
          <input id="phone" name="phone" type="tel" inputmode="tel" required aria-required="true" class="w-full border rounded-lg p-2" placeholder="(DDD) 9xxxx-xxxx">
        </div>

        <div>
          <label for="address" class="block font-medium text-gray-700 mb-1">Endere√ßo</label>
          <input id="address" name="address" type="text" required aria-required="true" class="w-full border rounded-lg p-2" placeholder="Rua, n√∫mero, bairro, cidade">
        </div>

        <div>
          <label for="serviceType" class="block font-medium text-gray-700 mb-1">Tipo de Servi√ßo</label>
          <input id="serviceType" name="serviceType" type="text" required aria-required="true" class="w-full border rounded-lg p-2" placeholder="Descreva o tipo de servi√ßo">
        </div>

        <div>
          <label for="description" class="block font-medium text-gray-700 mb-1">Descri√ß√£o Detalhada</label>
          <textarea id="description" name="description" rows="3" required aria-required="true" class="w-full border rounded-lg p-2" placeholder="Descreva o servi√ßo desejado ou problema"></textarea>
        </div>

        <div>
          <label for="evidence" class="block font-medium text-gray-700 mb-1">Evid√™ncias (Fotos)</label>
          <input id="evidence" name="evidence" type="file" accept="image/*" multiple class="block mt-1" aria-describedby="evidenceHelp">
          <div id="evidenceHelp" class="text-xs text-gray-500">Envie at√© X fotos. Se poss√≠vel, prefira imagens n√≠tidas.</div>
          <div id="preview" class="grid grid-cols-3 gap-2 mt-2" aria-live="polite"></div>
        </div>

        <div class="flex items-start gap-2">
          <input id="terms" name="terms" type="checkbox" required class="h-5 w-5 text-blue-600 border-gray-300 rounded mt-1">
          <label for="terms" class="text-gray-700 text-sm leading-snug">
            Autorizo o uso das informa√ß√µes e imagens enviadas para fins de execu√ß√£o do servi√ßo e registro da solicita√ß√£o.
          </label>
        </div>

        <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-full flex items-center justify-center gap-2 hover:bg-blue-700 transition" aria-label="Enviar solicita√ß√£o via WhatsApp">
          <i class="fa-solid fa-paper-plane" aria-hidden="true"></i> Enviar Solicita√ß√£o via WhatsApp
        </button>
      </form>

      <footer>
        Desenvolvido com üíô por <strong>STOS Company</strong> ‚Äî ¬© 2025
      </footer>
    </div>
  </div>

  <script>
    const form = document.getElementById('serviceForm');
    const evidenceInput = document.getElementById('evidence');
    const preview = document.getElementById('preview');
    let selectedFiles = [];
    let objectUrls = []; // para revogar depois

    function clearPreview() {
      // revoke object URLs
      objectUrls.forEach(url => {
        try { URL.revokeObjectURL(url); } catch (e) { /* ignore */ }
      });
      objectUrls = [];
      preview.innerHTML = '';
    }

    evidenceInput.addEventListener('change', e => {
      clearPreview();
      selectedFiles = Array.from(e.target.files || []);
      selectedFiles.forEach(file => {
        const url = URL.createObjectURL(file);
        objectUrls.push(url);
        const img = document.createElement('img');
        img.src = url;
        img.alt = file.name || 'Imagem enviada pelo usu√°rio';
        img.className = 'preview-img';
        preview.appendChild(img);
      });
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      const serviceType = document.getElementById('serviceType').value.trim();
      const description = document.getElementById('description').value.trim();
      const terms = document.getElementById('terms').checked;

      if (!name || !phone || !address || !serviceType || !description || !terms) {
        alert('Preencha todos os campos e aceite o termo de autoriza√ß√£o.');
        return;
      }

      const now = new Date();
      const dateTime = now.toLocaleString("pt-BR");

      const message = `
üí° *Solicita√ß√£o de Servi√ßo - Inova√ß√£o e Efici√™ncia*
üë§ *Nome:* ${name}
üì± *Telefone:* ${phone}
üè† *Endere√ßo:* ${address}
üõ†Ô∏è *Servi√ßo:* ${serviceType}
üìù *Descri√ß√£o:* ${description}
üì∏ *Evid√™ncias:* ${selectedFiles.length} foto(s) anexada(s)
‚è∞ *Data/Hora da Solicita√ß√£o:* ${dateTime}
‚úÖ *Autoriza√ß√£o:* O cliente autorizou o uso das informa√ß√µes para execu√ß√£o do servi√ßo.
      `.trim();

      try {
        const canShareFiles = !!(navigator.canShare && selectedFiles.length > 0 && navigator.canShare({ files: selectedFiles }));
        const canShare = !!navigator.share;

        if (canShare && canShareFiles) {
          // tenta compartilhar arquivos + texto (apenas em navegadores que suportam)
          await navigator.share({
            title: 'Solicita√ß√£o de Servi√ßo',
            text: message,
            files: selectedFiles
          });
          alert('Solicita√ß√£o enviada com sucesso via compartilhamento nativo!');
        } else if (canShare) {
          // compartilha apenas texto (se n√£o puder compartilhar arquivos)
          await navigator.share({ title: 'Solicita√ß√£o de Servi√ßo', text: message });
          alert('Solicita√ß√£o enviada com sucesso via compartilhamento nativo!');
        } else {
          // fallback para abrir WhatsApp (web ou app), sem anexos
          const encoded = encodeURIComponent(message);
          const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
          const url = isMobile ? `whatsapp://send?text=${encoded}` : `https://web.whatsapp.com/send?text=${encoded}`;

          // usar anchor para poder setar rel
          const a = document.createElement('a');
          a.href = url;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          document.body.appendChild(a);
          a.click();
          a.remove();

          alert('Seu dispositivo n√£o permite envio direto de fotos. Mensagem aberta no WhatsApp (sem anexos).');
        }

        form.reset();
        clearPreview();
        selectedFiles = [];

      } catch (err) {
        console.error('Erro ao compartilhar:', err);
        alert('Erro ao enviar. Verifique permiss√µes e tente novamente.');
      }
    });
  </script>
</body>
</html>

